(function (e) {
    Galleria.addTheme({
        name: "photo_essay",
        author: "Kresimir Nikolic, IAEA",
        css: "galleria.photo_essay.css",
        version: 1,
        defaults: {
            transition: "slide",
            imagecrop: true,
            initialTransition: "fade",
            _locale: {
                play: "Play slideshow",
                pause: "Pause slideshow",
                enter_fullscreen: "Enter fullscreen",
                exit_fullscreen: "Exit fullscreen"
            },
            _showFullscreen: true,
            _showProgress: true
        },
        init: function (t) {
            this.addElement("bar", "fullscreen", "play", "popout", "progress", "info-link");
            this.prependChild("info");
            this.append({
                stage: ["progress"],
                container: ["info"],
                info: ["play"]
            });
            this.prependChild("info-text", "counter");
            e(".galleria-info").prepend(e(".addthis_toolbox").css("position", "absolute").css("display", "block"));
            e(".galleria-info").prepend(e("#galleria-date").css("display", "block"));
            e(".galleria-info").prepend(e("h1").css("display", "block"));
            var n = this,
                r = this.$("play"),
                i = this.$("progress"),
                s = !! t.autoplay,
                o = Galleria.TOUCH,
                u = t.transition,
                a = t._locale;
            if (!Galleria.TOUCH) {
                this.addIdleState(this.get("image-nav-left"), {
                    left: -60
                });
                this.addIdleState(this.get("image-nav-right"), {
                    right: -60
                })
            }
            this.bind("play", function () {
                s = true;
                r.addClass("playing")
            });
            this.bind("pause", function () {
                s = false;
                r.removeClass("playing");
                i.width(0)
            });
            r.click(function () {
                n.defineTooltip("play", s ? a.play : a.pause);
                if (s) {
                    n.pause()
                } else {
                    n.play()
                }
            });
            if (t._showProgress) {
                this.bind("progress", function (e) {
                    i.width(e.percent / 100 * this.getStageWidth())
                })
            }
            this.bind("loadstart", function (e) {
                if (!e.cached) {
                    this.$("loader").show()
                }
            });
            this.bind("loadfinish", function (e) {
                i.width(0);
                this.$("loader").hide();
                this.refreshTooltip("counter", "caption")
            });
            this.bind("thumbnail", function (t) {
                if (!o) {
                    e(t.thumbTarget).css("opacity", .6).parent().hover(function () {
                        e(this).not(".active").children().stop().fadeTo(100, 1)
                    }, function () {
                        e(this).not(".active").children().stop().fadeTo(400, .6)
                    });
                    if (t.index === this.getIndex()) {
                        e(t.thumbTarget).css("opacity", 1)
                    }
                } else {
                    e(t.thumbTarget).css("opacity", this.getIndex() ? 1 : .6)
                }
            });
            this.bind("loadstart", function (t) {
                if (!t.cached) {
                    this.$("loader").show().fadeTo(200, .9)
                }
                this.$("info").toggle(this.hasInfo());
                e(t.thumbTarget).css("opacity", 1).parent().siblings().children().css("opacity", .6)
            });
            this.bind("loadfinish", function (e) {
                this.$("loader").fadeOut(200)
            })
        }
    })
})(jQuery)